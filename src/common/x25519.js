'use strict';var _createClass=function(){function g(h,k){for(var n,l=0;l<k.length;l++)n=k[l],n.enumerable=n.enumerable||!1,n.configurable=!0,'value'in n&&(n.writable=!0),Object.defineProperty(h,n.key,n)}return function(h,k,l){return k&&g(h.prototype,k),l&&g(h,l),h}}();function _classCallCheck(g,h){if(!(g instanceof h))throw new TypeError('Cannot call a class as a function')}var _X25519_ZERO=new Float64Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),_X25519_ONE=new Float64Array([1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),_X25519_NINE=new Uint8Array(32),_X25519_121665=new Float64Array([56129,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);_X25519_NINE[0]=9;var X25519=function(){function g(){_classCallCheck(this,g)}return _createClass(g,null,[{key:'getPublic',value:function getPublic(h){if(32!==h.byteLength)throw new Error('Secret wrong length, should be 32 bytes.');var k=new Uint8Array(h);return g._clamp(k),g._scalarMul(k,_X25519_NINE)}},{key:'getSharedKey',value:function getSharedKey(h,k){if(32!==h.byteLength||32!==k.byteLength)throw new Error('Secret key or public key wrong length, should be 32 bytes.');var l=new Uint8Array(h);return g._clamp(l),g._scalarMul(l,k)}},{key:'_add',value:function _add(h,k,l){for(var n=0;16>n;n++)h[n]=0|k[n]+l[n]}},{key:'_sub',value:function _sub(h,k,l){for(var n=0;16>n;n++)h[n]=0|k[n]-l[n]}},{key:'_mul',value:function _mul(h,k,l){var n=0,o=0,s=new Float64Array(31);for(n=0;16>n;n++)for(o=0;16>o;o++)s[n+o]+=k[n]*l[o];for(n=0;15>n;n++)s[n]+=38*s[n+16];g._car25519(s),g._car25519(s),g._copy(h,s)}},{key:'_sqr',value:function _sqr(h,k){g._mul(h,k,k)}},{key:'_scalarMul',value:function _scalarMul(h,k){var l=new Float64Array(80),n=new Float64Array(_X25519_ONE),o=new Float64Array(_X25519_ZERO),s=new Float64Array(_X25519_ZERO),t=new Float64Array(_X25519_ONE),u=new Float64Array(_X25519_ZERO),v=new Float64Array(_X25519_ZERO),w=new Uint8Array(h),x=0;g._unpack(l,k),g._copy(o,l);for(var C=254;0<=C;--C)x=1&w[C>>>3]>>>(7&C),g._sel25519(n,o,x),g._sel25519(s,t,x),g._add(u,n,s),g._sub(n,n,s),g._add(s,o,t),g._sub(o,o,t),g._sqr(t,u),g._sqr(v,n),g._mul(n,s,n),g._mul(s,o,u),g._add(u,n,s),g._sub(n,n,s),g._sqr(o,n),g._sub(s,t,v),g._mul(n,s,_X25519_121665),g._add(n,n,t),g._mul(s,s,n),g._mul(n,t,v),g._mul(t,o,l),g._sqr(o,u),g._sel25519(n,o,x),g._sel25519(s,t,x);for(var C=0;16>C;C++)l[C+16]=n[C],l[C+32]=s[C],l[C+48]=o[C],l[C+64]=t[C];var y=l.subarray(32),A=l.subarray(16);g._inv25519(y,y),g._mul(A,A,y);var B=new Uint8Array(32);return g._pack(B,A),B}},{key:'_inv25519',value:function _inv25519(h,k){var l=new Float64Array(16);g._copy(l,k);for(var n=253;0<=n;n--)g._sqr(l,l),2!==n&&4!==n&&g._mul(l,l,k);g._copy(h,l)}},{key:'_sel25519',value:function _sel25519(h,k,l){for(var n=0,s=0;16>s;s++)n=~(l-1)&(h[s]^k[s]),h[s]^=n,k[s]^=n}},{key:'_car25519',value:function _car25519(h){for(var k=0,l=0;16>l;l++)h[l]+=65536,k=Math.floor(h[l]/65536),h[(l+1)*(15>l?1:0)]+=k-1+37*(k-1)*(15===l?1:0),h[l]-=65536*k}},{key:'_unpack',value:function _unpack(h,k){for(var l=0;16>l;l++)h[l]=k[2*l]+(k[2*l+1]<<8)}},{key:'_pack',value:function _pack(h,k){var l=new Float64Array(16),n=new Float64Array(16),o=0,s=0;g._copy(n,k),g._car25519(n),g._car25519(n),g._car25519(n);for(var t=0;2>t;t++){for(l[0]=n[0]-65517,o=1;15>o;o++)l[o]=n[o]-65535-(1&l[o-1]>>16),l[o-1]&=65535;l[15]=n[15]-32767-(1&l[14]>>16),s=1&l[15]>>16,l[14]&=65535,g._sel25519(n,l,1-s)}for(o=0;16>o;o++)h[2*o]=255&n[o],h[2*o+1]=n[o]>>8}},{key:'_copy',value:function _copy(h,k){for(var l=k.length,n=0;n<l;n++)h[n]=k[n]}},{key:'_clamp',value:function _clamp(h){h[0]&=248,h[31]=64|127&h[31]}}]),g}();'undefined'!=typeof module&&(module.exports=X25519);
